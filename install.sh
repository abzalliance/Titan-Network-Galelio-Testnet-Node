#!/bin/bash

PURPLE='\033[0;35m'
NC='\033[0m' # скидання кольору

purple_echo() {
  echo -e "${PURPLE}$*${NC}"
}

# ==========================================
# Відображення логотипу
# ==========================================
purple_echo "Відображення логотипу..."

curl -s https://raw.githubusercontent.com/abzalliance/logo/main/logo.sh -o logo.sh

if [ -f logo.sh ]; then
    chmod +x logo.sh
    # Запускаємо logo.sh
    bash logo.sh
    # Пауза в 5 секунд
    sleep 5
    rm logo.sh
else
    purple_echo "Не вдалося завантажити логотип."
fi
set -e

######################################################
# Налаштування кольорів (фіолетовий)
######################################################
PURPLE='\033[0;35m'
NC='\033[0m' # скидання кольору

# Функція для зручного фіолетового виводу
purple_echo() {
  echo -e "${PURPLE}$*${NC}"
}

######################################################
# Крок 0. Встановлюємо залежності, потрібні команди
######################################################
purple_echo "Оновлюємо пакети та встановлюємо unzip, screen..."
sudo apt update
sudo apt install -y unzip screen

######################################################
# Крок 1. Встановлення Snap (якщо не встановлено)
######################################################
purple_echo "Встановлюємо Snap..."
sudo apt install -y snapd

purple_echo "Увімкнення Snap..."
sudo systemctl enable --now snapd.socket

######################################################
# Крок 2. Встановлення Multipass
######################################################
purple_echo "Встановлюємо Multipass..."
sudo snap install multipass

######################################################
# Крок 3. Завантаження інсталяційного пакету
######################################################
purple_echo "Завантажуємо агент..."
wget https://pcdn.titannet.io/test4/bin/agent-linux.zip

######################################################
# Крок 4. Створення теки /opt/titanagent
######################################################
purple_echo "Створюємо теку /opt/titanagent..."
mkdir -p /opt/titanagent

######################################################
# Крок 5. Розпакування агенту
######################################################
purple_echo "Розпаковуємо агент у /opt/titanagent..."
unzip agent-linux.zip -d /opt/titanagent

######################################################
# Крок 6. Дійте по інструкції нижче:
######################################################
purple_echo "=================================================="
purple_echo "Дійте по інструкції нижче:"
purple_echo "Створіть Screen: screen -S titan"
purple_echo "Перейдіть в папку Titan:  cd /opt/titanagent"
purple_echo "Запустіть: ./agent --working-dir=/opt/titanagent --server-url=https://test4-api.titannet.io --key=<your-key>"
purple_echo "Де: --key=<your-key>, вставте свій ключ."
purple_echo "Готово!"
purple_echo "=================================================="
